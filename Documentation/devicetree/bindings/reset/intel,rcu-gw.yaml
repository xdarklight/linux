# SPDX-License-Identifier: (GPL-2.0 OR BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/reset/intel,rcu-gw.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: System Reset Controller on Intel Gateway SoCs

maintainers:
  - Dilip Kota <eswara.kota@linux.intel.com>

properties:
  compatible:
    oneOf:
      - items:
          - enum:
              - lantiq,ase-rcu
              - lantiq,danube-rcu
              - lantiq,xrx100-rcu
              - lantiq,xrx200-rcu
          - const: simple-mfd
          - const: syscon
      - const: intel,rcu-lgm

  reg:
    description: Reset controller registers.
    maxItems: 1

  intel,global-reset:
    description: Global reset register offset and bit offset.
    $ref: /schemas/types.yaml#/definitions/uint32-array
    minItems: 2
    items:
      - description: Register offset
      - description: Register bit offset
        minimum: 0
        maximum: 31
      - description: Status bit offset (only if "#reset-cells" is 3)
        minimum: 0
        maximum: 31

  "#reset-cells":
    description: |
      First cell is reset request register offset.
      Second cell is bit offset in reset request register.
      Third cell is bit offset in reset status register.
      For LGM SoC, reset cell count is 2 as bit offset in
      reset request and reset status registers is same. Whereas
      3 for legacy SoCs as bit offset differs.

  "#address-cells":
    const: 1

  "#size-cells":
    const: 1

  big-endian: true

patternProperties:
  "^usb2-phy@[0-9a-f]+$":
    type: object
    $ref: "../phy/lantiq,xway-rcu-usb2-phy.yaml"

allOf:
  - if:
      properties:
        compatible:
          contains:
            const: intel,rcu-lgm
    then:
      properties:
        "#reset-cells":
          const: 2
  - if:
      properties:
        compatible:
          contains:
            enum:
              - lantiq,ase-rcu
              - lantiq,danube-rcu
              - lantiq,xrx100-rcu
              - lantiq,xrx200-rcu
    then:
      properties:
        "#reset-cells":
          const: 3

required:
  - compatible
  - reg
  - intel,global-reset
  - "#reset-cells"

additionalProperties: false

examples:
  - |
    rcu0: reset-controller@e0000000 {
        compatible = "intel,rcu-lgm";
        reg = <0xe0000000 0x20000>;
        intel,global-reset = <0x10 30>;
        #reset-cells = <2>;
    };

    pwm: pwm@e0d00000 {
        compatible = "intel,lgm-pwm";
        reg = <0xe0d00000 0x30>;
        clocks = <&cgu0 1>;
        #pwm-cells = <2>;
        resets = <&rcu0 0x30 21>;
    };
  - |
    rcu_xrx200: rcu@203000 {
        compatible = "lantiq,xrx200-rcu", "simple-mfd", "syscon";
        reg = <0x203000 0x100>;
        big-endian;

        #address-cells = <1>;
        #size-cells = <1>;

        #reset-cells = <3>;
        intel,global-reset = <0x10 30 29>;

        usb_phy0: usb2-phy@18 {
            compatible = "lantiq,xrx200-usb2-phy";
            reg = <0x18 4>, <0x38 4>;
            status = "disabled";

            resets = <&rcu_xrx200 0x48 4 4>, <&rcu_xrx200 0x10 4 4>;
            reset-names = "phy", "ctrl";
            #phy-cells = <0>;
        };

        usb_phy1: usb2-phy@34 {
            compatible = "lantiq,xrx200-usb2-phy";
            reg = <0x34 4>, <0x3c 4>;
            status = "disabled";

            resets = <&rcu_xrx200 0x48 5 5>, <&rcu_xrx200 0x10 4 4>;
            reset-names = "phy", "ctrl";
            #phy-cells = <0>;
        };
    };
